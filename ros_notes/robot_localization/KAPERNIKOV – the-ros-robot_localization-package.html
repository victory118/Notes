<!DOCTYPE html>
<!-- saved from url=(0058)https://kapernikov.com/the-ros-robot_localization-package/ -->
<html id="top"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<meta name="viewport" content="width=device-width" initial-scale="1">
	<!-- FAVICON -->
	<link rel="apple-touch-icon" sizes="180x180" href="https://kapernikov.com/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="https://kapernikov.com/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="https://kapernikov.com/favicon-16x16.png">
	<link rel="manifest" href="https://kapernikov.com/manifest.json">
	<link rel="mask-icon" href="https://kapernikov.com/safari-pinned-tab.svg" color="#5bbad5">
	<meta name="theme-color" content="#ffffff">
	<!--end FAVICON -->
	<meta name="description" content="Data, industry 4.0 &amp; prototyping">
	<title>KAPERNIKOV – Data, industry 4.0 &amp; prototyping</title>

	
<!-- This site is optimized with the Yoast SEO plugin v10.1.3 - https://yoast.com/wordpress/plugins/seo/ -->
<link rel="canonical" href="https://kapernikov.com/the-ros-robot_localization-package/">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="The ROS robot_localization package">
<meta property="og:description" content="Introduction The robot_localization package is a collection of non-linear state estimators for robots moving in 3D (or 2D) space. (package summary – documentation)  Each of the state estimators can fuse an arbitrary number of sensors (IMUs, odometers, indoor localization systems, GPS receivers…) to track the 15 dimensional (x, y, z, roll, pitch, yaw,x˙, y˙, z˙, roll˙, pitch˙, yaw˙, x¨, y¨, z¨) state of the robot. The documentation of the robot_localization package is quite …">
<meta property="og:url" content="https://kapernikov.com/the-ros-robot_localization-package/">
<meta property="og:site_name" content="KAPERNIKOV - Data, industry 4.0 &amp; prototyping">
<meta property="article:section" content="Show in LAB">
<meta property="article:published_time" content="2019-01-24T10:45:33+00:00">
<meta property="article:modified_time" content="2019-02-01T15:31:41+00:00">
<meta property="og:updated_time" content="2019-02-01T15:31:41+00:00">
<meta property="og:image" content="https://kapernikov.com/wp-content/uploads/2019/01/link-preview-illustratie@15x-2.jpg">
<meta property="og:image:secure_url" content="https://kapernikov.com/wp-content/uploads/2019/01/link-preview-illustratie@15x-2.jpg">
<meta property="og:image:width" content="1800">
<meta property="og:image:height" content="945">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="Introduction The robot_localization package is a collection of non-linear state estimators for robots moving in 3D (or 2D) space. (package summary – documentation)  Each of the state estimators can fuse an arbitrary number of sensors (IMUs, odometers, indoor localization systems, GPS receivers…) to track the 15 dimensional (x, y, z, roll, pitch, yaw,x˙, y˙, z˙, roll˙, pitch˙, yaw˙, x¨, y¨, z¨) state of the robot. The documentation of the robot_localization package is quite […]">
<meta name="twitter:title" content="The ROS robot_localization package">
<meta name="twitter:image" content="https://kapernikov.com/wp-content/uploads/2019/01/link-preview-illustratie@15x-2.jpg">
<!-- / Yoast SEO plugin. -->

<link rel="dns-prefetch" href="https://platform-api.sharethis.com/">
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="KAPERNIKOV - Data, industry 4.0 &amp; prototyping » The ROS robot_localization package Comments Feed" href="https://kapernikov.com/the-ros-robot_localization-package/feed/">
		<script async="" src="./KAPERNIKOV – the-ros-robot_localization-package_files/analytics.js"></script><script id="twitter-wjs" src="./KAPERNIKOV – the-ros-robot_localization-package_files/widgets.js"></script><script type="text/javascript" async="" src="./KAPERNIKOV – the-ros-robot_localization-package_files/insight.min.js"></script><script type="text/javascript" async="" src="./KAPERNIKOV – the-ros-robot_localization-package_files/insight.min.js"></script><script id="twitcount_plugins" src="./KAPERNIKOV – the-ros-robot_localization-package_files/twitcount.js"></script><script async="" src="./KAPERNIKOV – the-ros-robot_localization-package_files/gtm.js"></script><script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/kapernikov.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.1"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./KAPERNIKOV – the-ros-robot_localization-package_files/wp-emoji-release.min.js" type="text/javascript" defer=""></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="./KAPERNIKOV – the-ros-robot_localization-package_files/style.min.css" type="text/css" media="all">
<link rel="stylesheet" id="estilo-css" href="./KAPERNIKOV – the-ros-robot_localization-package_files/estilo.css" type="text/css" media="all">
<link rel="stylesheet" id="ssb-front-css-css" href="./KAPERNIKOV – the-ros-robot_localization-package_files/front.css" type="text/css" media="all">
<link rel="stylesheet" id="normalize-css" href="./KAPERNIKOV – the-ros-robot_localization-package_files/normalize.css" type="text/css" media="all">
<link rel="stylesheet" id="style-css" href="./KAPERNIKOV – the-ros-robot_localization-package_files/style.css" type="text/css" media="all">
<script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/jquery.js"></script>
<script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/jquery-migrate.min.js"></script>
<script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/fluidimage.js"></script>
<script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/front.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var SnazzyDataForSnazzyMaps = [];
SnazzyDataForSnazzyMaps={"id":151,"name":"Ultra Light with Labels","description":"Light Rust","url":"https:\/\/snazzymaps.com\/style\/151\/ultra-light-with-labels","imageUrl":"https:\/\/snazzy-maps-cdn.azureedge.net\/assets\/151-ultra-light-with-labels.png?v=20170626083737","json":"[{\"featureType\":\"water\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#e9e9e9\"},{\"lightness\":17}]},{\"featureType\":\"landscape\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#f5f5f5\"},{\"lightness\":20}]},{\"featureType\":\"road.highway\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#ffffff\"},{\"lightness\":17}]},{\"featureType\":\"road.highway\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#ffffff\"},{\"lightness\":29},{\"weight\":0.2}]},{\"featureType\":\"road.arterial\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#ffffff\"},{\"lightness\":18}]},{\"featureType\":\"road.local\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#ffffff\"},{\"lightness\":16}]},{\"featureType\":\"poi\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#f5f5f5\"},{\"lightness\":21}]},{\"featureType\":\"poi.park\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#dedede\"},{\"lightness\":21}]},{\"elementType\":\"labels.text.stroke\",\"stylers\":[{\"visibility\":\"on\"},{\"color\":\"#ffffff\"},{\"lightness\":16}]},{\"elementType\":\"labels.text.fill\",\"stylers\":[{\"saturation\":36},{\"color\":\"#333333\"},{\"lightness\":40}]},{\"elementType\":\"labels.icon\",\"stylers\":[{\"visibility\":\"off\"}]},{\"featureType\":\"transit\",\"elementType\":\"geometry\",\"stylers\":[{\"color\":\"#f2f2f2\"},{\"lightness\":19}]},{\"featureType\":\"administrative\",\"elementType\":\"geometry.fill\",\"stylers\":[{\"color\":\"#fefefe\"},{\"lightness\":20}]},{\"featureType\":\"administrative\",\"elementType\":\"geometry.stroke\",\"stylers\":[{\"color\":\"#fefefe\"},{\"lightness\":17},{\"weight\":1.2}]}]","views":554636,"favorites":1392,"createdBy":{"name":"hawasan","url":"http:\/\/www.haveasign.pl"},"createdOn":"2014-11-04T03:01:33.197","tags":["greyscale","light"],"colors":["gray","white"]};
/* ]]> */
</script>
<script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/snazzymaps.js"></script>
<script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/sharethis.js"></script>
<link rel="https://api.w.org/" href="https://kapernikov.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://kapernikov.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://kapernikov.com/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.1.1">
<link rel="shortlink" href="https://kapernikov.com/?p=1719">
<link rel="alternate" type="application/json+oembed" href="https://kapernikov.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fkapernikov.com%2Fthe-ros-robot_localization-package%2F">
<link rel="alternate" type="text/xml+oembed" href="https://kapernikov.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fkapernikov.com%2Fthe-ros-robot_localization-package%2F&amp;format=xml">
 <style media="screen">

        .simplesocialbuttons.simplesocialbuttons_inline .ssb-fb-like {
      margin: ;
    }
         /*inline margin*/
    
  
  
  
  
      .simplesocialbuttons.simplesocialbuttons_inline.simplesocial-round-icon button{
      margin: ;
    }

  
          /*margin-digbar*/

  
  
  
  
 
   
   

</style>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-KGX69W5');</script>
  <!-- End Google Tag Manager -->
<link rel="stylesheet" type="text/css" href="./KAPERNIKOV – the-ros-robot_localization-package_files/prettify.css"><link rel="stylesheet" type="text/css" href="./KAPERNIKOV – the-ros-robot_localization-package_files/twitcount.css" media="all"><script type="text/javascript">
(function() {
	(function (i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r;
		i[r] = i[r] || function () {
				(i[r].q = i[r].q || []).push(arguments)
			}, i[r].l = 1 * new Date();
		a = s.createElement(o),
			m = s.getElementsByTagName(o)[0];
		a.async = 1;
		a.src = g;
		m.parentNode.insertBefore(a, m)
	})(window, document, 'script', 'https://google-analytics.com/analytics.js', 'ga');

	ga('create', 'UA-28637770-1', 'auto');
			ga('send', 'pageview');
	})();

</script></head>

<body class="post-template-default single single-post postid-1719 single-format-standard" data-test="test" cz-shortcut-listen="true">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KGX69W5"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

	<div class="wrapper">

		<header class="smallPaddingContainerMobile paddingContainerDesktop">

			<nav>

				<div class="mainmenuwrapper">

					<div class="companyLogo">
							<a href="https://kapernikov.com/"><img src="./KAPERNIKOV – the-ros-robot_localization-package_files/companyLogo.png" alt=""></a>


							<p class="siteDescription">
								Data, industry 4.0 &amp; prototyping							</p>

					</div>


					<div class="menu-mainmenu-container"><ul id="mainMenu" class="mainMenu"><li id="menu-item-20" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-home menu-item-20"><a href="https://kapernikov.com/">Home</a></li>
<li id="menu-item-22" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-22"><a href="https://kapernikov.com/solutions/">Solutions</a></li>
<li id="menu-item-18" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-18"><a href="https://kapernikov.com/cases/">Cases</a></li>
<li id="menu-item-212" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-212"><a href="https://kapernikov.com/join-us/">Join us</a></li>
<li id="menu-item-1845" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1845"><a href="https://kapernikov.com/lab/">Lab</a></li>
<li id="menu-item-19" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-19"><a href="https://kapernikov.com/contact/">Contact</a></li>
</ul></div>
					<button class="mainMenuToggler" id="mainMenuToggler"></button>


				</div>

			</nav>

			          <div class="video-header-container video-header-desktop">
            <div class="headerBannerOverlay" style="opacity: 1;">	</div>
            <video playsinline="" autoplay="" muted="" loop="" poster="https://kapernikov.com/wp-content/uploads/2019/01/kapernikov_robot_localization_tutorial_illustration_v1_red_poster.jpg" id="bgvid" class="video-background-header">
              <source src="https://kapernikov.com/wp-content/themes/_kpotTheme/videos/kapernikov_robot_localization_tutorial_illustration_v1.webm" type="video/webm">
              <source src="https://kapernikov.com/wp-content/themes/_kpotTheme/videos/kapernikov_robot_localization_tutorial_illustration_v1.mp4" type="video/mp4">
            </video>
            <p class="video-header-title">The ROS robot_localization package</p>
          </div>

          <div class="largePaddingContainerMobile headerBanner video-header-mobile" style="background-image:url(https://kapernikov.com/wp-content/uploads/2019/01/ezgif.com-optimize-2.gif);">
            <div class="headerBannerOverlay" style="opacity: 1;">	</div>
            <p class="big-header-title">The ROS robot_localization package</p>
          </div>

          
					</header>

<main class="paddingContainerDesktop" role="main">

	<div class="pageContainer paddingContainerDesktop">

		<section class="articles offset largePaddingContainerMobile ">

			          				<h1 class="sectionTitle catchySentence">A no-hardware-required hands-on tutorial</h1>
        			
                  			<div class="pageIntro">
    				<p>&nbsp;</p>
<div id="ConnectiveDocSignExtentionInstalled" data-extension-version="1.0.4"></div>
    			</div>
              

      <!-- AUTHORPAGE -->
			

      <!-- MULTIPLE PEOPLE -->
      
			<div class="pageContent">
				<h2 class="p1"><span class="s1">Introduction</span></h2>
<p class="p2"><span class="s1">The robot_localization<span style="font-size: 13.3333px;">&nbsp;</span></span><span class="s1">package is a collection of non-linear state estimators for robots moving in 3D (or 2D) space.<span style="font-size: 13.3333px;">&nbsp;(</span><a href="http://wiki.ros.org/robot_localization" target="_blank" rel="noopener">package summary</a>&nbsp;–&nbsp;<a href="http://docs.ros.org/melodic/api/robot_localization/html/index.html" target="_blank" rel="noopener">documentation</a><span style="font-size: 13.3333px;">)&nbsp;</span></span></p>
<p class="p2"><span class="s1">Each of the state estimators can fuse an arbitrary number of sensors (IMUs, odometers, indoor localization systems, GPS receivers…) to track the 15 dimensional&nbsp;</span><em><strong>(x,&nbsp;y,&nbsp;z,&nbsp;roll,&nbsp;pitch,&nbsp;yaw,x˙,&nbsp;y˙,&nbsp;z˙,&nbsp;roll˙,&nbsp;pitch˙,&nbsp;yaw˙,&nbsp;x¨,&nbsp;y¨,&nbsp;z¨)</strong></em> state of the robot.</p>
<p><span class="s1">The documentation of the robot_localization package is quite clear once you know how it works. However, it lacks a hands-on tutorial to help you with your first steps. There are some great examples on how to set up the robot_localization package, but they require good working hardware. This tutorial tries to bridge the gap, using the <a href="http://wiki.ros.org/turtlesim" target="_blank" rel="noopener">turtlesim package</a>&nbsp;as a virtual robot. We will add a virtual odometer and a virtual (LiDAR) positioning system (both with a configurable systematic and random error) to the turtlesim robot and estimate its location by using the robot_localization package. Of course, you will need a system with ROS (the tutorial is developed and tested with ROS (1) Melodic Morenia on Ubuntu 18.04 Bionic Beaver) and a keyboard to control our turtlesim robot, but that’s it.</span></p>
<p class="p2"><span class="s1">I suppose you have some basic knowledge on ROS (if not, start with <a href="http://wiki.ros.org/ROS/Tutorials" target="_blank" rel="noopener">the beginner level tutorials</a>) and tf2 (if not, read&nbsp;<a href="http://wiki.ros.org/tf2/Tutorials" target="_blank" rel="noopener">the learning tf2 tutorials</a>) and you understand basic C++ code. You can use robot_localization from Python too, but I implemented the virtual sensors in C++.</span></p>
<h2 class="p1"><span class="s1">Coordinate systems for mobile robots</span></h2>
<p class="p1"><span class="s1">To understand how robot_localization works, we should first have a look at REP 103 “<a href="http://www.ros.org/reps/rep-0103.html" target="_blank" rel="noopener">Standard Units of Measure and Coordinate Conventions</a>”&nbsp;and REP 105 “<a href="http://www.ros.org/reps/rep-0105.html" target="_blank" rel="noopener">Coordinate Frames for Mobile Platforms</a>” which describe the coordinate system conventions used in ROS in general and for mobile robots in particular.</span></p>
<p class="p1"><span class="s1">REP 105 defines the tf2 coordinate frame tree for mobile robots:</span></p>
<p><em><strong>(earth)→map→odom→base_link</strong></em></p>
<p class="p1"><span class="s1">At the lowest level in this graph, the <i>base_link</i> is rigidly attached to the mobile robot’s base. The <i>base_link</i> frame can be attached in any arbitrary position or orientation, but REP 103 specifies the preferred orientation of the frame as X forward, Y left and Z up.</span></p>
<p class="p1"><span class="s1">The <i>odom</i> frame is a (more or less) world-fixed frame. The pose of the mobile robot in the <i>odom</i> frame can drift over time, making it useless as a long-term global reference. However, the pose of the robot in the <i>odom</i> frame is guaranteed to be continuous, making it suitable for tasks like visual servoing.</span></p>
<p class="p1"><span class="s1">The <i>map</i> frame is a world-fixed frame. The pose of the mobile robot in the <i>map</i> frame should not drift over time, but can change in discrete jumps. This makes the <i>map</i> frame perfect as a long-term global reference, but the discrete jumps make local sensing and acting difficult. REP 103 specifies the preferred orientation as X east, Y north and Z up, but in known structured environments aligning the X and Y axes with the environment is more useful (which is also acknowledged in REP103).</span></p>
<p class="p1"><span class="s1">The <i>earth</i> frame at the highest level in the graph is often not necessary, but it can be defined to link different <i>map</i> frames to allow interaction between mobile robots in different <i>map</i> frames or to allow robots to move from one <i>map</i> frame to another. We don’t use the <i>earth</i> frame in this tutorial.</span></p>
<p class="p2"><span class="s1">The tree, especially the construction with the <i>map</i> and <i>odom</i> frames, may look counterintuitive at first. It should make sense if you think about the&nbsp;</span><em><strong>odom→base_link</strong></em>&nbsp;transform as the (best) estimate of the mobile robot’s pose based on continuous sensors (IMUs, odometry sources, open-loop control…) only. The&nbsp;<em><strong>map→odom</strong></em> transform includes the non-continuous sensors (GPS, LiDAR based positioning system…) and models the jumps in the estimated position of the mobile robot, keeping the&nbsp;<em><strong>odom→base_link</strong></em> transform continuous. This approach provides a drift-free but non-continuous (<em><strong>map→base_link</strong></em>) as well as a continuous but drifting (<em><strong>odom→base_link</strong></em>) pose estimation of the mobile robot.</p>
<h2 class="p1"><span class="s1">How does robot_localization work?</span></h2>
<p class="p2"><span class="s1">The robot_localization state estimator nodes accept measurements from an arbitrary number of pose-related sensors. As of writing, they support nav_msgs/Odometry (position, orientation and linear and angular velocity), geometry_msgs/PoseWithCovarianceStamped (position and orientation), geometry_msgs/TwistWithCovarianceStamped (linear and angular velocity) and sensor_msgs/Imu (orientation, angular velocity and linear acceleration) messages.</span></p>
<p class="p2"><span class="s1">Based on these measurements, the state estimators publish the filtered position, orientation and linear and angular velocity (nav_msgs/Odometry) on the <i>/odometry/filtered</i> topic and (if enabled) the filtered acceleration on the <i>/accel/filtered</i> topics.</span></p>
<p class="p2"><span class="s1">In addition, they can publish (enabled by default) the corresponding transformation as a tf2 transform, either the&nbsp;</span><em><strong>odom→base_link</strong></em> transform or the <em><strong>map→odom</strong></em> transform (in this mode, they assume another node (possibly another robot_localization state estimator node) publishes the&nbsp;<em><strong>odom→base_link</strong></em> transform).</p>
<p class="p2"><span class="s1">So, to estimate and publish both the&nbsp;</span><em><strong>map→odom</strong></em> and the&nbsp;<em><strong>odom→base_link</strong></em> transforms (or state estimates), we need two robot_localization state estimators:</p>
<ul class="ul1">
<li class="li3"><span class="s1"><span class="s1">one for the <em><strong>odom→base_link</strong></em>&nbsp;</span></span>transform, which gets all continuous inputs (acceleration and linear and angular velocity) and</li>
<li class="li4"><span class="s1"><span class="s1">one for the <em><strong>map→odom</strong></em>&nbsp;</span></span>transform, which gets all (both continuous and non-continuous) inputs (acceleration, linear and angular velocity, position and orientation).</li>
</ul>
<p class="p2"><span class="s1">Together, they will estimate the full&nbsp;</span><em><strong>map→odom→base_link</strong></em> transform chain.</p>
<p class="p2"><span class="s1">The internals are beyond the scope of this tutorial, but if you want more information on what’s happening inside the state estimator nodes, have a look at “T. Moore and D. Stouch (2014), A Generalized Extended Kalman Filter Implementation for the Robot Operating System, in Proceedings of the 13th International Conference on Intelligent Autonomous Systems (IAS-13)” and its references.</span></p>
<h2 class="p1"><span class="s1">Introducing the turtlesim demonstrator</span></h2>
<p class="p1"><span class="s1">With this background knowledge and the instructions in the robot_localization tutorial, we should be able to configure the robot_localization package.</span></p>
<p class="p2"><span class="s1">To keep things really simple, we will use the turtlesim package (package summary and documentation: <a href="http://wiki.ros.org/turtlesim" target="_blank" rel="noopener"><span class="s2">http://wiki.ros.org/turtlesim</span></a>). You probably know this already from other ROS tutorials. It gives us turtlesim_node, which is nothing more than a square playground in which we can move one or more turtles that draw a line when they pass (just like the turtle that made the LOGO programming language famous in the 80s) and turtle_teleop_key to control a turtle using the keyboard (use the up and down arrows to move forward and backward and the left and right arrows to rotate counterclockwise and clockwise).</span></p>
<p><img class="aligncenter size-full wp-image-1742" src="./KAPERNIKOV – the-ros-robot_localization-package_files/robot_localization_tutori-002.png" alt="" srcset="https://kapernikov.com/wp-content/uploads/2019/01/robot_localization_tutori-002.png 501w, https://kapernikov.com/wp-content/uploads/2019/01/robot_localization_tutori-002-150x150.png 150w, https://kapernikov.com/wp-content/uploads/2019/01/robot_localization_tutori-002-300x300.png 300w" sizes="(max-width: 501px) 100vw, 501px"></p>
<p class="p1"><span class="s1">The first turtle, drawing a thick gray line, is our real turtlesim robot (the turtle’s shape is chosen randomly on creation, so it will vary from run to run). We will define two virtual sensors with a configurable frequency, systematic and random error: the position sensor will measure the turtle’s absolute position and orientation and is drawn with a thin blue line. The velocity sensor will measure the turtle’s linear and angular velocity and is drawn with a thin red line. The last turtle, drawing a thick green line, is robot_location’s estimate of the pose of the turtle in the <i>map</i> frame. </span></p>
<p class="p1"><span class="s1">Of course, our turtlebot lives in a constrained 2D world. There is not that much sensor data to fuse with only one position and velocity sensor and our turtlebot’s infinite acceleration (it starts and stops immediately) is not a perfect fit for the motion model in the state estimator. But it’s good enough to get us up and running with the robot_localization package.</span></p>
<p class="p1"><span class="s1">In this tutorial, we will only discuss the relevant parts of the demonstrator’s source code. You can find the <a href="https://github.com/Kapernikov/ros_robot_localization_tutorial" target="_blank" rel="noopener">full source code for this tutorial</a> in our GitHub repository. If you are familiar with the concepts and code in the beginner level ROS and learning tf2 tutorials, understanding the rest of the source code should be a piece of cake.</span></p>
<h2 class="p1"><span class="s1">Creating virtual sensors for the turtlesim robot</span></h2>
<p class="p2"><span class="s1">We start by creating two virtual sensors for our turtlebot: an odometer, ‘measuring’ the linear and angular velocity of the turtlebot and a position sensor, ‘measuring’ the absolute position and orientation of the turtlebot.</span></p>
<h3 class="p1"><span class="s1">Position sensor</span></h3>
<p class="p1"><span class="s1">Let’s start with the position sensor. You’ll find the full source code in the <i>ros-ws/src/robot_localization</i> directory. The <i>include/robot_localization/positioning_system.hpp</i> and <i>src/sensors/positioning_system.cpp</i> source files implement the position sensor class; the <i>src/sensors/positioning_system_node.cpp</i> starts a node for the sensor (accepting command-line parameters to configure the sensor).</span></p>
<p class="p1"><span class="s1">The position sensor does nothing more than listening to the <i>turtlesim/</i>Pose messages on the <i>turtle1/pose</i> topic, caching the messages it receives and sending <i>geometry_msgs/PoseWithCovarianceStamped</i> messages (with the received position plus a systematic and random error) on the <i>turtle1/sensors/pose</i> topic.</span></p>
<p class="p1"><span class="s1">Let’s have a look at the <i>src/sensors/positioning_system.cpp</i> source code.</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="s1"><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span></span><span class="typ">TurtlePositioningSystem</span><span class="pun">::</span><span class="typ">TurtlePositioningSystem</span><span class="pun">(</span><span class="pln">
      ros</span><span class="pun">::</span><span class="typ">NodeHandle</span><span class="pln"> node_handle</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> frequency</span><span class="pun">,</span><span class="pln">
      </span><span class="kwd">double</span><span class="pln"> error_x_systematic</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> error_x_random</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="kwd">double</span><span class="pln"> error_y_systematic</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> error_y_random</span><span class="pun">,</span><span class="pln">
      </span><span class="kwd">double</span><span class="pln"> error_yaw_systematic</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> error_yaw_random</span><span class="pun">,</span><span class="pln">
      </span><span class="kwd">bool</span><span class="pln"> visualize</span><span class="pun">):</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">node_handle_</span><span class="pun">{</span><span class="pln">node_handle</span><span class="pun">},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">turtle_pose_subscriber_</span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">node_handle_</span><span class="pun">.</span><span class="pln">subscribe</span><span class="pun">(</span><span class="str">"turtle1/pose"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">16</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="pun">&amp;</span><span class="typ">TurtlePositioningSystem</span><span class="pun">::</span><span class="pln">turtlePoseCallback</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">turtle_pose_publisher_</span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">node_handle_</span><span class="pun">.</span><span class="pln">advertise</span><span class="pun">&lt;</span><span class="pln">geometry_msgs</span><span class="pun">::</span><span class="typ">PoseWithCovarianceStamped</span><span class="pun">&gt;(</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="str">"turtle1/sensors/pose"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">16</span><span class="pun">)},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">frequency_</span><span class="pun">{</span><span class="pln">frequency</span><span class="pun">},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">random_generator_</span><span class="pun">{},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">random_distribution_x_</span><span class="pun">{</span><span class="pln">error_x_systematic</span><span class="pun">,</span><span class="pln"> error_x_random</span><span class="pun">},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">random_distribution_y_</span><span class="pun">{</span><span class="pln">error_y_systematic</span><span class="pun">,</span><span class="pln"> error_y_random</span><span class="pun">},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">random_distribution_yaw_</span><span class="pun">{</span><span class="pln">error_yaw_systematic</span><span class="pun">,</span><span class="pln"> error_yaw_random</span><span class="pun">},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">frame_sequence_</span><span class="pun">{</span><span class="lit">0</span><span class="pun">},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">visualize_</span><span class="pun">{</span><span class="pln">visualize_</span><span class="pun">},</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">visualization_turtle_name_</span><span class="pun">{</span><span class="str">""</span><span class="pun">}</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="pun">}</span><span class="pln">
</span><span class="s1"><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="typ">TurtlePositioningSystem</span><span class="pun">::~</span><span class="typ">TurtlePositioningSystem</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="pun">}</span></span></pre>
<p class="p1"><span class="s1">The <i>/turtle1/pose</i> subscriber’s callback just caches the received pose. If the sensor is asked to visualize its measurements, it also calls the <i>spawnAndConfigureVisualizationTurtle</i> function to create a new turtle and set its line color to blue when receiving the first message.</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="s1"><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span></span><span class="kwd">void</span><span class="pln"> </span><span class="typ">TurtlePositioningSystem</span><span class="pun">::</span><span class="pln">turtlePoseCallback</span><span class="pun">(</span><span class="pln">
      </span><span class="kwd">const</span><span class="pln"> turtlesim</span><span class="pun">::</span><span class="typ">PoseConstPtr</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">cached_pose_timestamp_ </span><span class="pun">=</span><span class="pln"> ros</span><span class="pun">::</span><span class="typ">Time</span><span class="pun">::</span><span class="pln">now</span><span class="pun">();</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">cached_pose_ </span><span class="pun">=</span><span class="pln"> </span><span class="pun">*</span><span class="pln">message</span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="com">// If this is the first message, initialize the visualization turtle.</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="kwd">if</span><span class="pun">(</span><span class="pln">isVisualizationRequested</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">isVisualizationTurtleAvailable</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">spawnAndConfigureVisualizationTurtle</span><span class="pun">(*</span><span class="pln">message</span><span class="pun">);</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pun">}</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="pun">}</span></pre>
<p class="p1"><span class="s1">The spin function handles the main loop. At the requested measurement frequency, it retrieves the most recent pose received by the <i>/turtle1/pose</i> subscriber and distort it using the <i>std::normal_distribution</i>s initialised in the constructor. This pose and an appropriate covariance matrix are packed in a <i>geometry_msgs/PoseWithCovarianceStamped</i> message. Note that the pose is expressed in the <i>map</i> frame (it’s an absolute, non-continuous measurement) and that we only use the fields required for a 2D pose estimation (we’ll ask the state estimator node to work in 2D mode in the launch file). Finally, this message is published on the <i>/turtle1/sensors/pose</i> topic. If we asked to visualize the measurement, move the visualization turtle to the measured location.</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="s1"><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span></span><span class="kwd">void</span><span class="pln"> </span><span class="typ">TurtlePositioningSystem</span><span class="pun">::</span><span class="pln">spin</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pln">ros</span><span class="pun">::</span><span class="typ">Rate</span><span class="pln"> rate</span><span class="pun">(</span><span class="pln">frequency_</span><span class="pun">);</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="kwd">while</span><span class="pun">(</span><span class="pln">node_handle_</span><span class="pun">.</span><span class="pln">ok</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">ros</span><span class="pun">::</span><span class="pln">spinOnce</span><span class="pun">();</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="com">// Distort real pose to get a 'measurement'.</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="kwd">auto</span><span class="pln"> measurement </span><span class="pun">=</span><span class="pln"> cached_pose_</span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">measurement</span><span class="pun">.</span><span class="pln">x </span><span class="pun">+=</span><span class="pln"> random_distribution_x_</span><span class="pun">(</span><span class="pln">random_generator_</span><span class="pun">);</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">measurement</span><span class="pun">.</span><span class="pln">y </span><span class="pun">+=</span><span class="pln"> random_distribution_y_</span><span class="pun">(</span><span class="pln">random_generator_</span><span class="pun">);</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">measurement</span><span class="pun">.</span><span class="pln">theta </span><span class="pun">+=</span><span class="pln"> random_distribution_yaw_</span><span class="pun">(</span><span class="pln">random_generator_</span><span class="pun">);</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="com">// Publish measurement.</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">geometry_msgs</span><span class="pun">::</span><span class="typ">PoseWithCovarianceStamped</span><span class="pln"> current_pose</span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">current_pose</span><span class="pun">.</span><span class="pln">header</span><span class="pun">.</span><span class="pln">seq </span><span class="pun">=</span><span class="pln"> </span><span class="pun">++</span><span class="pln"> frame_sequence_</span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">current_pose</span><span class="pun">.</span><span class="pln">header</span><span class="pun">.</span><span class="pln">stamp </span><span class="pun">=</span><span class="pln"> ros</span><span class="pun">::</span><span class="typ">Time</span><span class="pun">::</span><span class="pln">now</span><span class="pun">();</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">current_pose</span><span class="pun">.</span><span class="pln">header</span><span class="pun">.</span><span class="pln">frame_id </span><span class="pun">=</span><span class="pln"> </span><span class="str">"map"</span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">current_pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="pln">x </span><span class="pun">=</span><span class="pln"> measurement</span><span class="pun">.</span><span class="pln">x</span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">current_pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> measurement</span><span class="pun">.</span><span class="pln">y</span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">current_pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="pln">z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">current_pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">orientation </span><span class="pun">=</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="pln">tf</span><span class="pun">::</span><span class="pln">createQuaternionMsgFromRollPitchYaw</span><span class="pun">(</span><span class="pln">
          </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> measurement</span><span class="pun">.</span><span class="pln">theta</span><span class="pun">);</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">current_pose</span><span class="pun">.</span><span class="pln">pose</span><span class="pun">.</span><span class="pln">covariance </span><span class="pun">=</span><span class="pln"> boost</span><span class="pun">::</span><span class="pln">array</span><span class="pun">&lt;</span><span class="kwd">double</span><span class="pun">,</span><span class="pln"> </span><span class="lit">36</span><span class="pun">&gt;({</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="pln">std</span><span class="pun">::</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">random_distribution_x_</span><span class="pun">.</span><span class="pln">mean</span><span class="pun">()</span><span class="pln">
                   </span><span class="pun">+</span><span class="pln"> random_distribution_x_</span><span class="pun">.</span><span class="pln">stddev</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> std</span><span class="pun">::</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">random_distribution_y_</span><span class="pun">.</span><span class="pln">mean</span><span class="pun">()</span><span class="pln">
                       </span><span class="pun">+</span><span class="pln"> random_distribution_y_</span><span class="pun">.</span><span class="pln">stddev</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">2</span><span class="pun">),</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">,</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="pln">std</span><span class="pun">::</span><span class="pln">pow</span><span class="pun">(</span><span class="pln">random_distribution_yaw_</span><span class="pun">.</span><span class="pln">mean</span><span class="pun">()</span><span class="pln">
                     </span><span class="pun">+</span><span class="pln"> random_distribution_yaw_</span><span class="pun">.</span><span class="pln">stddev</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)});</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">turtle_pose_publisher_</span><span class="pun">.</span><span class="pln">publish</span><span class="pun">(</span><span class="pln">current_pose</span><span class="pun">);</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="kwd">if</span><span class="pun">(</span><span class="pln">isVisualizationRequested</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> isVisualizationTurtleAvailable</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="pln">moveVisualizationTurtle</span><span class="pun">(</span><span class="pln">measurement</span><span class="pun">);</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pun">}</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="com">// Sleep until we need to publish a new measurement.</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; </span></span><span class="pln">rate</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">();</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="pun">}</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="pun">}</span><span class="pln">
</span><span class="s1"><span class="pun">}</span></span></pre>
<h3 class="p1"><span class="s1">&nbsp;</span><span class="s1">Velocity sensor (odometry)</span></h3>
<p class="p1"><span class="s1">The code of the velocity sensor is very similar. The <i>include/robot_localization/odometry.hpp</i> and <i>src/sensors/odometry.cpp</i> source files implement the sensor class; the <i>src/sensors/odometry_node.cpp</i> starts a node for the sensor (accepting command-line parameters to configure the sensor).</span></p>
<p class="p1"><span class="s1">The constructor, destructor and <i>/turtle1/pose</i> subscriber’s callback are almost identical to their position sensor counterparts. We calculate the angular velocity as the product of the linear velocity and the angular velocity error. This allows us to simulate a sensor with a systematic deviation from the straight line. This happens when we have a differential drive robot with different systematic errors on its wheel encoders. You can see that the turtlebot in the screenshot above (the one drawing a red line) has a clear deviation to the left. The velocity is measured (orientation and magnitude) relative to the robot, so it is expressed in the <i>base_link</i> frame (it could be transformed to a pose change in the <i>odom</i> frame, but the velocity (and acceleration when available) itself is expressed in the <i>base_link</i> frame).</span></p>
<h2 class="p1"><span class="s1">Configuring robot_localization</span></h2>
<p class="p1"><span class="s1">We configure robot_localization via the launch file. First, we launch the <i>turtlesim/turtlesim_node</i> node to visualize the turtle, its sensor outputs and the position estimate and a <i>turtlesim/turtle_teleop_key</i> node to control the turtle using the keyboard.</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="tag">&lt;launch&gt;</span><span class="pln">
</span><span class="s1"><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="tag">&lt;node</span><span class="pln"> </span><span class="atn">pkg</span><span class="pun">=</span><span class="atv">"turtlesim"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"turtlesim_node"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"turtlesim"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="tag">&lt;node</span><span class="pln"> </span><span class="atn">pkg</span><span class="pun">=</span><span class="atv">"turtlesim"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"turtle_teleop_key"</span><span class="pln">
        </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"teleop"</span><span class="pln">
        </span><span class="atn">output</span><span class="pun">=</span><span class="atv">"screen"</span><span class="pln"> </span><span class="tag">/&gt;</span></span></pre>
<p class="p1"><span class="s1">The position sensor has a standard deviation of 0.2 units on the X and Y coordinates (the turtle’s playground above is 11 units wide and high) and 0.2 radians on the orientation of the turtle. The systematic error is unspecified and defaults to zero. It publishes a measurement every second.</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">  </span><span class="tag">&lt;node</span><span class="pln"> </span><span class="atn">pkg</span><span class="pun">=</span><span class="atv">"robot_localization_demo"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"positioning_system_node"</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp;   &nbsp; &nbsp; </span></span><span class="atn">name</span><span class="pun">=</span><span class="atv">"turtle1_positioning_system_node"</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp;   &nbsp; </span></span><span class="atn">args</span><span class="pun">=</span><span class="atv">"-f 1. -x 0.2 -y 0.2 -t 0.2 -v"</span><span class="pln">
        </span><span class="atn">output</span><span class="pun">=</span><span class="atv">"screen"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre>
<p class="p1"><span class="s1">The velocity sensor publishes measurements at 10 Hz. It has a random error of 0.05 units/s (standard deviation) on the linear velocity and a systematic error of 0.02 times the linear velocity on the angular velocity (positive = counterclockwise).</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">  </span><span class="tag">&lt;node</span><span class="pln"> </span><span class="atn">pkg</span><span class="pun">=</span><span class="atv">"robot_localization_demo"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"odometry_node"</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp;   &nbsp; &nbsp; </span></span><span class="atn">name</span><span class="pun">=</span><span class="atv">"turtle1_odometry_node"</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp;   &nbsp; </span></span><span class="atn">args</span><span class="pun">=</span><span class="atv">"-f 20. -x 0.05 -X 0. -t 0. -T 0.02 -v"</span><span class="pln">
        </span><span class="atn">output</span><span class="pun">=</span><span class="atv">"screen"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre>
<p class="p1"><span class="s1">As discussed earlier, we need two state estimator nodes: one for the&nbsp;<strong><em>odom→base_link</em></strong> transform and one for the&nbsp;</span><em><strong>map→odom</strong></em>&nbsp;transform. Let’s start with the first one. It updates its estimate at 10 Hz, we ask it to run in 2D mode, we explicitly ask to publish the tf2 transform too (although that is the default behavior), we specify the <i>map</i>, <i>odom</i> and <i>base_link</i> frames and by specifying the <i>odom</i> frame as the <i>world_frame</i>, we ask to estimate the&nbsp;<em><strong>odom→base_link</strong></em> transform.</p>
<p class="p1"><span class="s1">We have one velocity sensor <i>twist0</i> (all sensor topic names should start at 0 for the first sensor of a given type). We specify its topic (<i>/turtle1/sensors/twist</i>), we take the absolute value, not the difference between the current and the previous value (in general, if you have multiple similar sensors, all but one are used in differential mode, see the documentation for details) and it provides&nbsp;</span><em><strong>x˙</strong></em>,&nbsp;<em><strong>y˙</strong></em>&nbsp;<i></i>and&nbsp;<em><strong>yaw˙</strong></em> measurements (we know our turtlebot can’t move sideways, so the&nbsp;<em><strong>y˙=0</strong></em> measurement is a valid measurement). The true and false values<span class="Apple-converted-space">&nbsp; </span>are the parameters of the 15-dimensional state&nbsp;<em><strong>(x,&nbsp;y,&nbsp;z,&nbsp;roll,&nbsp;pitch,&nbsp;yaw,x˙,&nbsp;y˙,&nbsp;z˙,&nbsp;roll˙,&nbsp;pitch˙,&nbsp;yaw˙,&nbsp;x¨,&nbsp;y¨,&nbsp;z¨)</strong></em>.<span class="s1"><span class="Apple-converted-space">&nbsp; </span><!--?prettify linenums=true?--></span></p>
<pre class="prettyprint prettyprinted" style=""><span class="s1"><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span></span><span class="tag">&lt;node</span><span class="pln"> </span><span class="atn">pkg</span><span class="pun">=</span><span class="atv">"robot_localization"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ekf_localization_node"</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp;   </span></span><span class="atn">name</span><span class="pun">=</span><span class="atv">"robot_localization_ekf_node_odom"</span><span class="pln">
        </span><span class="atn">clear_params</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"frequency"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"10."</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"sensor_timeout"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"0.2"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"two_d_mode"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"publish_tf"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"map_frame"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"map"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"odom_frame"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"odom"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"base_link_frame"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"base_link"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"world_frame"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"odom"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;remap</span><span class="pln"> </span><span class="atn">from</span><span class="pun">=</span><span class="atv">"odometry/filtered"</span><span class="pln"> </span><span class="atn">to</span><span class="pun">=</span><span class="atv">"odometry/filtered_twist"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"twist0"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"turtle1/sensors/twist"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"twist0_differential"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"false"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;rosparam</span><span class="pln"> </span><span class="atn">param</span><span class="pun">=</span><span class="atv">"twist0_config"</span><span class="tag">&gt;</span><span class="pln">
      [false, false, false, false, false, false,
</span><span class="Apple-converted-space"><span class="pln">&nbsp;&nbsp; &nbsp; &nbsp; </span></span><span class="pln">true, true, false, false, false, true,
</span><span class="Apple-converted-space"><span class="pln">&nbsp;&nbsp; &nbsp; &nbsp; </span></span><span class="pln">false, false, false]</span><span class="tag">&lt;/rosparam&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="tag">&lt;/node&gt;</span></pre>
<p class="p1"><span class="s1">The configuration of the&nbsp;</span><em><strong>map→odom</strong></em> state estimator node is similar, but it gets input not only from the velocity sensor, but also from the position sensor (providing <em><strong>x</strong></em>,&nbsp;<em><strong>y</strong></em> and&nbsp;<em><strong>yaw</strong></em> measurements).</p>
<pre class="prettyprint prettyprinted" style=""><span class="s1"><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span></span><span class="tag">&lt;node</span><span class="pln"> </span><span class="atn">pkg</span><span class="pun">=</span><span class="atv">"robot_localization"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ekf_localization_node"</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="atn">name</span><span class="pun">=</span><span class="atv">"robot_localization_ekf_node_map"</span><span class="pln">
        </span><span class="atn">clear_params</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"frequency"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"10"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"sensor_timeout"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"0.2"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"two_d_mode"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"publish_tf"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"map_frame"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"map"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"odom_frame"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"odom"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"base_link_frame"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"base_link"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"world_frame"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"map"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"twist0"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"turtle1/sensors/twist"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;rosparam</span><span class="pln"> </span><span class="atn">param</span><span class="pun">=</span><span class="atv">"twist0_config"</span><span class="tag">&gt;</span><span class="pln">
      [false, false, false, false, false, false,
</span><span class="Apple-converted-space"><span class="pln">&nbsp;&nbsp; &nbsp; &nbsp; </span></span><span class="pln">true, true, false, false, false, true,
</span><span class="Apple-converted-space"><span class="pln">&nbsp;&nbsp; &nbsp; &nbsp; </span></span><span class="pln">false, false, false]</span><span class="tag">&lt;/rosparam&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;param</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"pose0"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"turtle1/sensors/pose"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;rosparam</span><span class="pln"> </span><span class="atn">param</span><span class="pun">=</span><span class="atv">"pose0_config"</span><span class="tag">&gt;</span><span class="pln">
      [true, true, false, false, false, true,
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp;</span></span><span class="pln">false, false, false, false, false, false,
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp;</span></span><span class="pln">false, false, false]</span><span class="tag">&lt;/rosparam&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; </span></span><span class="tag">&lt;remap</span><span class="pln"> </span><span class="atn">from</span><span class="pun">=</span><span class="atv">"odometry/filtered"</span><span class="pln"> </span><span class="atn">to</span><span class="pun">=</span><span class="atv">"odometry/filtered_map"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span><span class="tag">&lt;/node&gt;</span></pre>
<p class="p1"><span class="s1">Finally, we add a helper node to show a turtle (drawing a thick green line) at the estimated position (</span><em><strong>map→…→base_link</strong></em>).</p>
<pre class="prettyprint prettyprinted" style=""><span class="s1"><span class="Apple-converted-space"><span class="pln">&nbsp; </span></span></span><span class="tag">&lt;node</span><span class="pln"> </span><span class="atn">pkg</span><span class="pun">=</span><span class="atv">"robot_localization_demo"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"transformation_visualization_node"</span><span class="pln">
</span><span class="Apple-converted-space"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="atn">name</span><span class="pun">=</span><span class="atv">"transformation_visualization_node"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="s1"><span class="tag">&lt;/launch&gt;</span></span></pre>
<h2 class="p1"><span class="s1">Running the project</span></h2>
<p class="p1"><span class="s1">First, source your preferred ROS version <i>setup.bash</i> (if you don’t do it in your <i>~/.bashrc</i> already):</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">source </span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">ros</span><span class="pun">/</span><span class="pln">melodic</span><span class="pun">/</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">bash</span></pre>
<p class="p1"><span class="s1">Then, go to the <i>ros-ws</i> directory in the tutorial root directory and build the tutorial code:</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">cd </span><span class="pun">~</span><span class="str">/…/</span><span class="pln">robot</span><span class="pun">-</span><span class="pln">localization</span><span class="pun">-</span><span class="pln">demo</span><span class="pun">/</span><span class="pln">ros</span><span class="pun">-</span><span class="pln">ws
catkin_make</span></pre>
<p class="p1"><span class="s1">Finally, you are ready to run the demo. Source this workspace <i>setup.bash</i> and start the demo by using <i>roslaunch</i>:</span></p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">source </span><span class="pun">./</span><span class="pln">devel</span><span class="pun">/</span><span class="pln">setup</span><span class="pun">.</span><span class="pln">bash
roslaunch robot_localization_demo robot_localization_demo</span><span class="pun">.</span><span class="pln">launch</span></pre>
<p class="p1"><span class="s1">You can control the turtle using your keyboard’s arrow keys. Just make sure you have the input focus on the terminal running the <i>roslaunch</i> command (and the <i>turtlesim/turtle_teleop_key</i> node), not the turtlebot window itself.</span></p>
<p class="p2"><span class="s1">You can play with the systematic and random errors of both sensors (have a look at the source code or launch the nodes with the <i>–help</i> option to see which command line parameters they support) and with the covariance they report. You can change the covariance in the source code (I implemented them in the source code to make them dependent on the systematic and random errors specified when starting the node) or override them in the launch file or a parameter file (have a look at the robot_localization package’s documentation for details).</span></p>
<h2 class="p3"><span class="s1">Using your own (real) sensors</span></h2>
<p class="p1"><span class="s1">After reading this tutorial, you should more or less know how robot_localization works. I didn’t show you all options of the robot_localization state estimator nodes and I didn’t show how to use the navsat_transform_node to integrate GPS data but you should have the background knowledge to read the robot_localization package documentation and know how it applies to your sensors.</span></p>
<div id="ConnectiveDocSignExtentionInstalled" data-extension-version="1.0.4"></div>

							</div>


					</section></div>
	

  
	<div class="random-posts">
  				<!-- RANDOM POSTS -->
  				<a href="https://kapernikov.com/kapernikov-tackles-point-cloud-processing-mini-hackathon/" style="background-image: url(https://kapernikov.com/wp-content/uploads/2018/02/Blog-afbeelding-1.png)" class="random-post">
  					<h3>Kapernikov tackles Point Cloud Processing in Mini-hackathon</h3>
  					<div class="random-meta">
  						Point cloud data In order to improve vegetation management alongside its rail tr...  						<div class="random-meta-small">
  							<p>22/02/2018</p>
  							  						</div>
  					</div>

  				</a>

				   
  				<!-- RANDOM POSTS -->
  				<a href="https://kapernikov.com/doing-things-nobody-has-done-before/" style="background-image: url(https://kapernikov.com/wp-content/uploads/2018/04/maarten@2x.png)" class="random-post">
  					<h3>Doing things nobody has done before</h3>
  					<div class="random-meta">
  						It has been a long time since Maarten was playing with his MSX computer and Fisc...  						<div class="random-meta-small">
  							<p>17/06/2018</p>
  							  								<p>Maarten De Munck</p>
  							  						</div>
  					</div>

  				</a>

				   
  				<!-- RANDOM POSTS -->
  				<a href="https://kapernikov.com/opportunities-for-those-who-pursue-them/" style="background-image: url(https://kapernikov.com/wp-content/uploads/2018/03/ezechiel.png)" class="random-post">
  					<h3>Opportunities for those who pursue them</h3>
  					<div class="random-meta">
  						Robots, computer vision, artificial intelligence… This might sound like s...  						<div class="random-meta-small">
  							<p>21/03/2018</p>
  							  								<p>Ezechiël Syx</p>
  							  						</div>
  					</div>

  				</a>

				   </div></main>

		
		<footer class="paddingContainerDesktop" id="footer">
			<section>
				<div class="smallPaddingContainer"><img src="./KAPERNIKOV – the-ros-robot_localization-package_files/footerCompanyLogo.png" alt=""></div>
			</section>


			<section class="footerContact">

				<div class="footerMobile footerContent">

				
					<h1>Contact</h1>

					<p class="footerMobile marginBottom"><a href="mailto:info@kapernikov.com">info@kapernikov.com</a><br>
					<a href="tel:+3216369907">+32 16 36 99 07</a></p>

					<p>BTW: BE 0837.602.918</p>

				</div>

        <div class="footerMobile footerContent">

  				
					<h1>Locations</h1>

					<p class="marginBottom">
  					<b>Main office</b><br>
            Bedrijvencentrum Pepibru<br>
  					Barastraat 173-177<br>
  					1070 Brussel (BE)
          </p>
					<p class="marginBottom">
  					<b>Administration office</b><br>
  					Wilselsesteenweg 75, bus 0001<br>
  					3010 Leuven (BE)
          </p>

					<p>
  					<b>Regional office</b><br>
  					Stationsstraat 72<br>
  					9450 Haaltert (BE)
          </p>
				</div>


				<div>
					<h1>ABOUT US</h1>

					<p><span style="line-height: normal;">Belgium's leading experts in data, automation and prototyping</span></p>
<br>
     				<a class="linkBtn" href="https://kapernikov.com/about/">Read more</a>
				</div>


        <div>

          <h1>Menu</h1>

          <ul class="footerMenu" id="footerMenu"><li><a href="https://kapernikov.com/">Home</a></li><li><a href="https://kapernikov.com/solutions/">Solutions</a></li><li><a href="https://kapernikov.com/cases/">Cases</a></li><li><a href="https://kapernikov.com/join-us/">Join us</a></li><li><a href="https://kapernikov.com/lab/">Lab</a></li><li><a href="https://kapernikov.com/blog/">Blog</a></li><li><a href="https://kapernikov.com/about/">About us</a></li><li><a href="https://kapernikov.com/contact/">Contact</a></li></ul>

        </div>


				<div class="footerMobile footerContent">
					<h1>Connect</h1>
          <a class="linkBtn" target="_blank" href="https://www.facebook.com/kapernikov/" style="margin-bottom: 10px;">Facebook</a>
          <a class="linkBtn" target="_blank" href="https://www.linkedin.com/company/kapernikov/" style="margin-bottom: 10px;">Linked in</a>
          <a class="linkBtn" href="https://kapernikov.com/blog" style="margin-bottom: 10px;">Blog</a>
          <a class="linkBtn nieuwsbriefButton" href="https://kapernikov.com/the-ros-robot_localization-package/#">Newsletter</a>
          <div class="hidden nieuwsbriefForm">
            		<form method="POST" class="cm_ajax_shortcode_form" id="cm_ajax_shortcode_2">
		<input type="hidden" name="cm_ajax_shortcode_action" value="subscribe">
		<input type="hidden" name="cm_ajax_shortcode" value="2">
		
		<!-- <p><label for="cm-ajax-email"></label> -->
		<input class="widefat" placeholder="example@kapernikov.com" id="cm-ajax-email" name="cm-ajax-email" type="text"><p></p>

		<p style="width: 100%; text-align: center;">
		<span style="display: none;" class="cm_ajax_success">Great news, we've signed you up.</span>
		<span style="display: none;" class="cm_ajax_failed">Sorry, we weren't able to sign you up. Please check your details, and try again.<br><br></span>
		<span style="display:none;" class="cm_ajax_loading"><img alt="Loading..." src="./KAPERNIKOV – the-ros-robot_localization-package_files/loader.gif"></span>
		<input type="submit" name="cm-ajax-submit" value="Subscribe">
		</p>
		</form>
		<script type="text/javascript">
			jQuery(document).ready(function() {
				jQuery('form#cm_ajax_shortcode_2 input:submit').click(function() {

					jQuery('form#cm_ajax_shortcode_2 input:submit').hide();
					jQuery('form#cm_ajax_shortcode_2 .cm_ajax_success').hide();
					jQuery('form#cm_ajax_shortcode_2 .cm_ajax_failed').hide();
					jQuery('form#cm_ajax_shortcode_2 .cm_ajax_loading').show();
					jQuery.ajax(
						{ type: 'POST',
						  data: jQuery('form#cm_ajax_shortcode_2').serialize()+'&cm_ajax_response=ajax',
						  success: function(data) {
										jQuery('form#cm_ajax_shortcode_2 .cm_ajax_loading').hide();
										if (data == 'SUCCESS') {
											jQuery('form#cm_ajax_shortcode_2 .cm_ajax_success').show();
										} else {
											jQuery('form#cm_ajax_shortcode_2 input:submit').show();
											jQuery('form#cm_ajax_shortcode_2 .cm_ajax_failed').show();
										}
									}
						}
					);
					return false;
					});
				});
		</script>

		          </div>
				</div>




				<p class="footerMobile footerArrowUp"><a class="footerMobile footerBTT" href="https://kapernikov.com/the-ros-robot_localization-package/#top"><img src="./KAPERNIKOV – the-ros-robot_localization-package_files/headerArrow.png" alt=""></a></p>
			</section>
		</footer>
		<span></span><style type="text/css" class="fluid-images">img{max-width:100%;height:auto;}</style><script>
    jQuery(document).ready(function () {
		jQuery.post('https://kapernikov.com?ga_action=googleanalytics_get_script', {action: 'googleanalytics_get_script'}, function(response) {
			var s = document.createElement("script");
			s.type = "text/javascript";
			s.innerHTML = response;
			jQuery("head").append(s);
		});
    });
</script><script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/pretty.js"></script>
<script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/main.js"></script>
<script type="text/javascript" src="./KAPERNIKOV – the-ros-robot_localization-package_files/wp-embed.min.js"></script>
<script type="text/javascript">		var ssb_admin_ajax = 'https://kapernikov.com/wp-admin/admin-ajax.php';
		var ssb_post_id = 1414 ;
		var ssb_post_url = 'https://kapernikov.com/more-data-more-colleagues/';
		var ssb_alternate_post_url = 'http://kapernikov.com/more-data-more-colleagues/';
		jQuery( document ).ready(function(){
		var is_ssb_used = jQuery('.simplesocialbuttons');
		if( is_ssb_used ) {

			var data = {
			'action': 'ssb_fetch_data',
			'postID': ssb_post_id
		};
			jQuery.post(ssb_admin_ajax, data, function(data, textStatus, xhr) {
				var array = JSON.parse(data);

				jQuery.each( array, function( index, value ){

					if( index == 'total' ){
						jQuery('.ssb_'+ index +'_counter').html(value + '<span>Shares</span>');
					}else{
						jQuery('.ssb_'+ index +'_counter').html(value);
					}
				});

			});
		}
		})

		document.addEventListener("DOMContentLoaded", function() {
			var if_ssb_exist = document.getElementsByClassName( "simplesocialbuttons" ).length > 0;
			if (if_ssb_exist) {
				ssbPlugin.fetchFacebookShares();
			}
		});


		</script><script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://static1.twitcount.com/js/twitcount.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitcount_plugins');</script>
	<div>

  <!-- conversion tracking -->

  <script type="text/javascript">
    _linkedin_partner_id = "86030";
    window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
    window._linkedin_data_partner_ids.push(_linkedin_partner_id);
    </script><script type="text/javascript">
    (function(){var s = document.getElementsByTagName("script")[0];
    var b = document.createElement("script");
    b.type = "text/javascript";b.async = true;
    b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
    s.parentNode.insertBefore(b, s);})();
  </script>
  <noscript>
    <img height="1" width="1" style="display:none;" alt="" src="https://dc.ads.linkedin.com/collect/?pid=86030&fmt=gif" />
  </noscript>

  <!-- LINKED IN PIXEL -->
	<script type="text/javascript"> _linkedin_data_partner_id = "86030"; </script><script type="text/javascript"> (function(){var s = document.getElementsByTagName("script")[0]; var b = document.createElement("script"); b.type = "text/javascript";b.async = true; b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js"; s.parentNode.insertBefore(b, s);})(); </script> <noscript> <img height="1" width="1" style="display:none;" alt="" src="https://dc.ads.linkedin.com/collect/?pid=86030&fmt=gif" /> </noscript>


<!-- Hummingbird cache file was created in 0.083003997802734 seconds, on 13-04-19 20:59:51 --></div></div><iframe src="./KAPERNIKOV – the-ros-robot_localization-package_files/portal.html" id="st_gdpr_iframe" style="width: 0px; height: 0px; position: absolute; left: -5000px;"></iframe><iframe scrolling="no" frameborder="0" allowtransparency="true" src="./KAPERNIKOV – the-ros-robot_localization-package_files/widget_iframe.2e9f365dae390394eb8d923cba8c5b11.html" title="Twitter settings iframe" style="display: none;"></iframe><script src="./KAPERNIKOV – the-ros-robot_localization-package_files/saved_resource" type="text/javascript"></script></body></html>